# FreeBSD 2013 年 4-6 月状态报告

- 原文链接：<https://www.freebsd.org/status/report-2013-04-2013-06.html>

# 介绍

本报告涵盖了 2013 年 4 月至 6 月期间与 FreeBSD 相关的项目。这是计划在 2013 年发布的四份报告中的第二份。

过去三个月对于 FreeBSD 开发者社区来说异常活跃，期间举办了包括 BSDCan 和与之联合举行的 FreeBSD 开发者峰会（详细内容请参见单独的报告，[BSDCan 开发者峰会特别篇](https://www.freebsd.org/status/report-2013-05-devsummit.html)）以及 BSD-Day 2013 等活动。此外，FreeBSD 系统在各个方面都有了改进。桌面用户会高兴地注意到，在改善 AMD GPU 状态以及让与内核模式设置相关的控制台交互——这一功能是近期 xorg 驱动所必需的——方面有了进展，同时，关于让二进制包更易于使用的工作也在继续。开发者将注意到我们工具链的持续改进，新调试器正在准备集成。服务器用户将受益于内核虚拟化支持和可扩展性方面的各种改进。当然，FreeBSD 系统如果没有可在其上运行的应用程序是无法存在的，而这一季度，端口团队成员为确保用户有广泛的桌面和开发环境选择而不懈努力，其中包括 GNOME、KDE、Xfce 和 Haskell 团队的亮点内容。

感谢所有报告员的卓越工作！本报告包含 33 个条目，希望您能享受阅读。

涵盖 2013 年 7 月至 9 月期间内容的提交截止日期为 2013 年 10 月 7 日。

# [FreeBSD 团队报告](https://www.freebsd.org/status/report-2013-04-2013-06.html#FreeBSD-Team-Reports)

## [FreeBSD 核心团队](https://www.freebsd.org/status/report-2013-04-2013-06.html#FreeBSD-Core-Team)

联系方式：FreeBSD 核心团队 \<[core@FreeBSD.org](mailto:core@FreeBSD.org)\>

在 2013 年第二季度，核心团队批准了新的安全官员 Dag-Erling Sm�rgrav 以及他的副手 Xin Li。核心团队感谢即将离任的安全官员 Simon Nielsen 为该职位所作的贡献。Peter Wemm 负责主导 FreeBSD 集群的重组和管理工作，在核心团队的批准下，Glen Barber 和 Ryan Steinmetz 被迎接加入集群管理团队。

基于 Martin Wilke 的建议和经验，核心团队还支持设立一个端口管理者和发布工程师之间的联络人角色，以改善他们的沟通，特别是在准备发布版本时。核心团队欢迎 Bryan Drewery 担任此角色。

响应 Eitan Adler 的请求，核心团队同意从基础系统中移除 CVS，紧接着由 Peter Wemm 实现并导入了一版轻量级的 Subversion 工具。

本季度共为 3 名新开发者发放了源码提交权限，另外 1 名现有的提交者获得了权限延续。

## [FreeBSD 邮件管理员团队](https://www.freebsd.org/status/report-2013-04-2013-06.html#FreeBSD-Postmaster-Team)

| 链接 |
| ------- |

联系方式：FreeBSD 邮件管理员团队 \<[postmaster@FreeBSD.org](mailto:postmaster@FreeBSD.org)\>

在 2013 年第二季度，FreeBSD 邮件管理员团队实施了以下可能引起公众关注的事项：

* 在 clusteradm 的帮助下，发现 unbound（在 mx1 和 mx2 上使用的解析器）被配置为执行 DNSSEC 验证，这意味着如果签名区失败验证，unbound 将拒绝使用该信息。这导致一位用户在区域签名刷新之前无法与 FreeBSD.org 交换电子邮件。
* 创建了 freebsd-dtrace 邮件列表，这是 George Neville-Neil 提出的请求。
* 复活了 freebsd-testing 邮件列表，这是 Garrett Cooper 提出的请求。
* 创建了 freebsd-tex 邮件列表，这是 Hiroki Sato 提出的请求。
* 针对另一条评论，即如果灰名单（greylisting）是原因，我们的消息拒绝提示不够清晰，重新措辞了该提示。
* 扩展了 secteam 可接受的 MIME 类型，包括以下类型，以便发送加密邮件：

  * application/pgp-encrypted
  * application/pkcs7-encrypted
  * application/x-pkcs7-encrypted
  * multipart/encrypted
* 开始用 freebsd-gecko 替代 freebsd-mozilla。

---

## [FreeBSD 发布工程团队](https://www.freebsd.org/status/report-2013-04-2013-06.html#FreeBSD-Release-Engineering-Team)

| 链接 |
| ------- |
|       |
|       |

联系方式：FreeBSD 发布工程团队 \<[re@FreeBSD.org](mailto:re@FreeBSD.org)\>

FreeBSD 8.4-RELEASE 版本周期已于 2013 年 6 月 7 日完成，约比原定计划晚了两个月。发布后发现的任何问题，请务必阅读 Errata 通知。

FreeBSD 9.2-RELEASE 版本的过程将于 2013 年 7 月 6 日开始。如果没有出现任何关键问题，预计 FreeBSD 9.2-RELEASE 将在 8 月底或 9 月初发布。

鼓励跟踪 FreeBSD 9.*X* 分支的用户尽可能测试 -BETA 和 -RC 版本，并将反馈和问题报告到 [freebsd-stable 邮件列表](http://lists.freebsd.org/pipermail/freebsd-stable)。

---

## [FreeBSD 安全团队](https://www.freebsd.org/status/report-2013-04-2013-06.html#FreeBSD-Security-Team)

| 链接 |
| ------- |

联系方式：FreeBSD 安全团队 \<[secteam@FreeBSD.org](mailto:secteam@FreeBSD.org)\>

在 4 月 15 日，Dag-Erling Smørgrav 和李鑫接任 FreeBSD 项目的安全官员，团队在 6 月迎回了 Qing Li。此报告简要总结了安全团队从 4 月至 6 月末的工作。

安全团队发布了以下安全公告：

* FreeBSD-SA-13:05.nfsserver: NFS 服务器（nfsd(8)）中的输入验证不足，由 Adam Nowacki 报告。
* FreeBSD-SA-13:06.mmap: 通过 mmap() 提升特权，由 Konstantin Belousov 报告。

安全团队还贡献了以下勘误通知：

* FreeBSD-EN-13:02.vtnet: 在 QEMU 1.4.0 及更高版本中，当配置多个 MAC 地址时，帧无法正确转发到 vtnet(4)（在 8.4-RELEASE 中），由 Julian Stecklina 报告。
* FreeBSD-EN-13:01.fxp: 在 8.4-RELEASE 中，初始化 fxp(4) 网络接口时与 dhclient(8) 发生无限循环，由 Michael L. Squires 报告。

根据 Baptiste Daroussin 的请求，安全团队还审查了 Poudriere 的源代码，这是一个计划用于在 FreeBSD 集群上生成 pkg(8)（“新风格”）包的端口构建和测试系统。

# [项目](https://www.freebsd.org/status/report-2013-04-2013-06.html#Projects)

## [PC-BSD](https://www.freebsd.org/status/report-2013-04-2013-06.html#PC-BSD)

| 链接 |
| ------- |
| [PC-BSD 官方网站](http://www.pcbsd.org/ "http://www.pcbsd.org")      |

联系方式：Kris Moore \<[kmoore@FreeBSD.org](mailto:kmoore@FreeBSD.org)\>

PC-BSD 和 TrueOS 向“滚动发布”模式的迁移进展迅速。我们已经实现了自己的软件包仓库，完全基于 pkg(8)，并且每月更新两次，同时还托管了专用的 freebsd-update(8) 系统。除了 9.1-RELEASE 的 ISO 镜像，我们还开始创建 9-STABLE 分支，并使用 freebsd-update(8) 每月推送最新的世界和内核二进制文件。

我们目前正在为桌面和服务器实现 ZFS 启动环境。用户可以将更新或实验版本安装到独立的 ZFS 克隆中，并在启动时选择要运行的版本，这为升级前的测试提供了一个简便的方式。

---

## [虚拟私人系统](https://www.freebsd.org/status/report-2013-04-2013-06.html#Virtual-Private-Systems)

| 链接 |
| ------- |
|       |
|       |

联系方式：Klaus Ohrhallinger \<[k@7he.at](mailto:k@7he.at)\>

VPS for FreeBSD 是基于操作系统级虚拟化的实现，支持像实时迁移这样的高级特性。该项目最近已经作为项目分支被导入到项目的 Subversion 仓库中。目前代码仍处于 alpha 质量阶段。

### 待办事项：

1. 使用不同的客户端设置/应用程序进行测试。所有反馈都非常欢迎。

---

# [内核](https://www.freebsd.org/status/report-2013-04-2013-06.html#Kernel)

## [AMD GPU 内核模式设置支持](https://www.freebsd.org/status/report-2013-04-2013-06.html#AMD-GPU-Kernel-Mode-setting-Support)

| 链接 |
| ------- |
| [项目状态 wiki](https://wiki.freebsd.org/AMD_GPU "https://wiki.freebsd.org/AMD_GPU")      |

联系方式：Jean-Sébastien Pédron \<[dumbbell@FreeBSD.org](mailto:dumbbell@FreeBSD.org)\>  
联系方式：Konstantin Belousov \<[kib@FreeBSD.org](mailto:kib@FreeBSD.org)\>

由于 4 月至 6 月底期间的非 FreeBSD 相关活动，该项目进展缓慢：

* 修复了 TTM 中的一些重要问题，目前正在解决其他一些问题。受这些问题影响的应用程序包括非线性视频编辑软件（不使用 Xv 进行视频预览）或 VirtualBox 中的“screen”等。
* 关于 OpenGL 锁定问题，尚未进行任何工作。glxgears 可以正常运行，但一些现代桌面环境或 WebGL 演示会挂起。一旦上述 TTM 错误修复完毕，这将是下一个目标。
* 已经向 Mesa 提交了让其开箱即用的补丁，上游已合并部分，但并非所有补丁都已合并。此外，通过与 Jonathan Gray（OpenBSD）的联合工作，Mesa 应该可以在 FreeBSD、OpenBSD 及其他 BSD 系统上工作，无需额外的补丁。

几位用户测试了该驱动程序。Andriy Gapon、Jonathan Gray 和 Mark Kettenis（OpenBSD）提交了补丁，kyzh 慷慨捐赠了几张来自不同系列的独立显卡。感谢所有贡献者！

该驱动程序仍然不够稳定，尚不适合广泛邀请测试者。

### 待办事项：

1. 编写 wiki 指南，解释如何测试该驱动程序。

## [改进的 TCP SYN Cookies](https://www.freebsd.org/status/report-2013-04-2013-06.html#Improved-TCP-SYN-Cookies)

| 链接 |
| ------- |
| [描述](http://docs.freebsd.org/cgi/getmsg.cgi?fetch=28838+0+current/freebsd-net "http://docs.freebsd.org/cgi/getmsg.cgi?fetch=28838+0+current/freebsd-net")      |
| [补丁](http://people.freebsd.org/~andre/syncookie-20130708.diff "http://people.freebsd.org/~andre/syncookie-20130708.diff")      |

联系方式：Andre Oppermann \<[andre@FreeBSD.org](mailto:andre@FreeBSD.org)\>

我们已经实现了 SYN cookie 很长时间了，但它在当前窗口扩展（window scaling）和 SACK 编码中的一些局限性，特别是在少量可用位的情况下。

这个补丁通过以下方式更新和改进了 SYN cookies：

1. 在初始序列号（ISN）中编码 MSS、WSCALE（窗口扩展）和 SACK，而无需使用时间戳位。
2. 切换到非常快速且加密强度较高的 SipHash-2-4 哈希 MAC 算法，以防止 SYN cookie 被伪造。

自从 SYN cookies 发明约 17 年以来，TCP 会话中常见的参数发生了很大变化。今天，我们有了更多的带宽，这使得窗口扩展几乎是强制性的。而且 SACK 已经成为标准，因为它使得丢包恢复变得更加高效。

最初的 SYN cookies 方法仅在 cookie 中存储了一个索引的 MSS 值。显然，这不再足够，并且在存在 WSCALE 时会出现问题。WSCALE 信息仅在 SYN 和 SYN-ACK 时交换。如果我们无法跟踪它，那么我们就会严重低估可用的发送或接收窗口，再加上窗口扩展较大时，TCP 段头中的窗口大小信息会更低。

几年前，SYN cookies 被扩展为在 TCP 时间戳字段中存储额外的状态（如果连接支持时间戳）。这一方法也被 Linux 采用。虽然 BSD、Linux 和其他 Unix 系统中都支持时间戳，但 Windows 从未默认启用它们，因此对于绝大多数互联网上的客户端来说，时间戳并不可用。

这个补丁中的新改进将所有必要的信息重新移动到 ISN 中，从而消除了对时间戳的需求。MSS 和发送 WSCALE 被以 3 位索引形式存储，并且有一个单独的位用于 SACK。虽然我们不能仅用 3 位表示所有可能的 MSS 和 WSCALE 值（它们在 TCP 头部中是 16 位字段），但事实证明这并非实际需要的。

这些改进允许仅在面向互联网的服务器上运行 SYN cookies。然而，尽管 SYN cookies 始终被计算和发送，但只有在 syn 缓存因攻击或过载而溢出时才会使用。在这种情况下，您可以放心，TCP 连接建立的性能将不再受到显著影响，即使是 Windows 客户端也可以利用窗口扩展和 SACK。

### 待办事项：

1. 在繁忙的服务器上进行额外测试。

---

## [多线程 Pagedaemon](https://www.freebsd.org/status/report-2013-04-2013-06.html#Multi-threaded-Pagedaemon)

| 链接 |
| ------- |
|       |

联系方式：Konstantin Belousov \<[kib@FreeBSD.org](mailto:kib@FreeBSD.org)\>

该项目旨在提高虚拟内存子系统的可扩展性。基于 Jeff Roberson 提供的原型变更，已经实现了每域页面队列和每域 pagedaemon 工作线程，以支持这一目标。目前，域与 NUMA 接近域重合，但这并不是必需的，并且可以通过进一步分离来改进，以便在 pagedaemon 中实现更多的并行性。

该补丁相对简单，最微妙的部分是页面清理（page laundry）和 OOM 逻辑，这要求所有 pagedaemon 线程之间协调，以防止误触发。

需要在不同的工作负载和真实的多插槽机器上进行测试。

该项目由 FreeBSD 基金会赞助。

### 待办事项：

1. 在多域 NUMA 机器上进行调试。
2. 测试，进行代码审查并提交。

## [原生 iSCSI 堆栈](https://www.freebsd.org/status/report-2013-04-2013-06.html#Native-iSCSI-Stack)

| 链接 |
| ------- |
|       |

联系方式：Edward Tomasz Napierała \<[trasz@FreeBSD.org](mailto:trasz@FreeBSD.org)\>

原生内核 iSCSI 目标和启动器项目在 4 月到 6 月期间取得了良好的进展。主要的工作是为 iSER（基于 RDMA 的 iSCSI）在启动器和目标中引入支持。为此，首先需要将一些通用部分合并，并为用户空间缺少 iSER 支持实现一个解决方法。除此之外，还有许多小的改进。例如，创建了更易于使用的管理工具，如 iscsictl(8)，它显示每个 iSCSI 会话的 SCSI 设备节点。这使得用户不再需要通过 camcontrol(8) 获取相同的信息。此外，还对日志记录和手册页做了改进。

一旦 iSER 支持稳定，工作将重点转向性能优化。计划在 8 月提交新的启动器和目标，以便将其包含在 10.0 版本中。项目还将继续实现对软件 iWARP 堆栈（主要用于测试和开发）、SCSI 直通和其他改进的支持。

该项目由 FreeBSD 基金会赞助。

### 待办事项：

1. 性能优化。
2. 合并到 FreeBSD 主干。

---

## [Newcons 重启](https://www.freebsd.org/status/report-2013-04-2013-06.html#Newcons-Reboot)

联系方式：Aleksandr Rybalko \<[ray@FreeBSD.org](mailto:ray@FreeBSD.org)\>

Newcons 项目的目的是为控制台和视频输出提供新的接口，支持图形设备。这将允许简单的驱动程序在早期访问控制台和终端模式，并为 Xorg 提供帧缓冲访问。驱动程序将不再需要嵌入的字体位图、色彩图或鼠标光标位图，因为整个基础设施将由 vt(4) Newcons 驱动程序提供。

由于该项目包括内核模式设置（KMS）的集成，其中一个目标是支持现代的 Xorg 版本，使内核能够在图形模式或分辨率变更后切换回虚拟终端模式。

项目涉及很多更改，主要任务包括：

* 核心功能（几乎完成）。
* 鼠标支持。
* KMS（内核模式设置）支持。
* USB 键盘支持。
* 启动画面支持（部分完成）。
* 驱动程序支持。
* vidcontrol(1) 支持。

该项目的第一批交付物，包括 moused(8)、ukbd(4) 和 KMS 支持，预计将在 2013 年 8 月中旬或底部交付。整个项目预计将在 2013 年 11 月完成。

该项目由 FreeBSD 基金会赞助。

感谢 Ed Schouten 启动了 Newcons 项目并完成了大部分工作。

### 待办事项：

1. 提供不同类型的硬件来测试实现。发布测试邀请时，请积极参与。

---

## [Realtek RTL8188CU/RTL8192CU USB 无线驱动](https://www.freebsd.org/status/report-2013-04-2013-06.html#Realtek-RTL8188CU/RTL8192CU-USB-Wireless-Driver)

联系方式：Rui Paulo \<[rpaulo@FreeBSD.org](mailto:rpaulo@FreeBSD.org)\>
联系方式：Kevin Lo \<[kevlo@FreeBSD.org](mailto:kevlo@FreeBSD.org)\>

已从 OpenBSD 导入驱动程序 urtwn(4) 。这是一个针对非常小型的 Realtek USB WiFi 卡的驱动，这些网卡价格便宜，可以实现最大理论速度为 150 Mbps 的 802.11n。这些卡非常适合嵌入式系统，如树莓派和 BeagleBone。该驱动需要固件，这些固件可以从 FreeBSD Ports 集合中的 net/urtwn-firmware-kmod 获取。请注意，目前尚不支持 802.11n 。

